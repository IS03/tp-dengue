Tengo mi base de datos con las siguientes tablas (mostrando 10 filas por cada tabla para que veas el esquma y el tipo de datos):
Tabla: clima
                        fecha id_estacion  precipitacion_pluviometrica  \
0  2018-01-01 00:00:00.000000     A872801                     0.000000   
1  2018-01-02 00:00:00.000000     A872801                     0.000000   
2  2018-01-03 00:00:00.000000     A872801                     0.000000   
3  2018-01-04 00:00:00.000000     A872801                     0.000000   
4  2018-01-05 00:00:00.000000     A872801                     0.589565   
5  2018-01-06 00:00:00.000000     A872801                     0.000000   
6  2018-01-07 00:00:00.000000     A872801                     0.000000   
7  2018-01-08 00:00:00.000000     A872801                     0.000000   
8  2018-01-09 00:00:00.000000     A872801                     0.000000   
9  2018-01-10 00:00:00.000000     A872801                     0.000000   

   temperatura_minima  temperatura_maxima  temperatura_media  humedad_media  \
0                15.9                29.4           22.30069           52.0   
1                14.1                32.2           23.74722           44.0   
2                12.6                33.5           25.04375           38.0   
3                17.1                36.4           27.37709           43.0   
4                17.9                28.7           22.27430           91.0   
5                12.1                27.5           20.76528           40.0   
6                15.6                32.5           23.65764           44.0   
7                17.8                33.9           26.05764           36.0   
8                20.3                33.9           26.82639           45.0   
9                23.6                35.9           28.88194           58.0   

   rocio_medio  tesion_vapor_media  radiacion_global  heliofania_efectiva  \
0     12.40972            14.57236          27.55428            11.318030   
1     12.22327            14.48487          16.85220             5.099066   
2     10.18355            12.56902          18.67926             6.167767   
3     15.27765            17.47291          16.98126             5.186137   
4     17.58082            20.23586           2.17254             8.526174   
5     10.10269            12.56994          28.42842            11.866210   
6     11.11564            13.36892          28.09620            11.683060   
7     13.24320            15.33703          28.08228            11.686070   
8     14.43365            16.66493          28.68048            12.046750   
9     19.66387            22.92191          26.20985            10.618740   

   heliofania_relativa  
0                 79.0  
1                 35.0  
2                 43.0  
3                 36.0  
4                 59.5  
5                 83.0  
6                 82.0  
7                 82.0  
8                 84.0  
9                 74.0  

Tabla: calendario
        fecha  anio  mes  dia  trimestre  semestre  quincena  semanaMes  \
0  1960-01-01  1960    1    1          1         1         1          1   
1  1960-01-02  1960    1    2          1         1         1          1   
2  1960-01-03  1960    1    3          1         1         1          1   
3  1960-01-04  1960    1    4          1         1         1          1   
4  1960-01-05  1960    1    5          1         1         1          1   
5  1960-01-06  1960    1    6          1         1         1          1   
6  1960-01-07  1960    1    7          1         1         1          1   
7  1960-01-08  1960    1    8          1         1         1          2   
8  1960-01-09  1960    1    9          1         1         1          2   
9  1960-01-10  1960    1   10          1         1         1          2   

   semana  diaSemana  diaNumeroSemana  bisiesto  
0      53    Viernes                4         1  
1      53     Sábado                5         1  
2      53    Domingo                6         1  
3       1      Lunes                0         1  
4       1     Martes                1         1  
5       1  Miércoles                2         1  
6       1     Jueves                3         1  
7       1    Viernes                4         1  
8       1     Sábado                5         1  
9       1    Domingo                6         1  

Tabla: provincias
      provincia  id_provincia
0  BUENOS AIRES             0
1          CABA             1
2     CATAMARCA             2
3         CHACO             3
4        CHUBUT             4
5    CORRIENTES             5
6       CÓRDOBA             6
7    ENTRE RÍOS             7
8       FORMOSA             8
9         JUJUY             9

Tabla: localidades
          localidad     provincia  latitud  longitud  id_localidad  \
0        25 DE MAYO  BUENOS AIRES   -35.48    -60.13             0   
1         ARRECIFES  BUENOS AIRES   -34.05    -60.14             1   
2          BALCARCE  BUENOS AIRES   -37.76    -58.30             2   
3         BORDENAVE  BUENOS AIRES   -37.75    -63.08             3   
4         CHASCOMUS  BUENOS AIRES   -35.74    -58.05             4   
5   CORONEL DORREGO  BUENOS AIRES   -38.67    -60.93             5   
6    CORONEL SUAREZ  BUENOS AIRES   -37.29    -62.04             6   
7             FERRÉ  BUENOS AIRES   -34.10    -61.14             7   
8   GENERAL LINCOLN  BUENOS AIRES   -34.84    -61.60             8   
9  GENERAL VILLEGAS  BUENOS AIRES   -34.92    -62.73             9   

   id_provincia  
0             0  
1             0  
2             0  
3             0  
4             0  
5             0  
6             0  
7             0  
8             0  
9             0  

Tabla: departamentos
  id_departamento            departamento    latitud   longitud  id_provincia  \
0           82105            SAN JERONIMO -32.239935 -61.231266            20   
1           38112                    YAVI -22.329812 -65.825982             9   
2           62035                  EL CUY -39.866718 -68.703438            14   
3            6623               PERGAMINO -33.589305 -60.772765             0   
4            6868            VILLA GESELL -37.336673 -57.032501             0   
5            6343             GENERAL PAZ -35.451906 -58.269542             0   
6           42007                 ATREUCO -37.126296 -63.829211            10   
7           62091              25 DE MAYO -41.512714 -69.517356            15   
8           70077                  RAWSON -31.649200 -68.501500            17   
9            6315  GENERAL JUAN MADARIAGA -37.024628 -56.956074             0   

   id_localidad  
0           128  
1            78  
2           102  
3            14  
4            11  
5             4  
6            82  
7           107  
8           113  
9            11  

Tabla: estaciones
   id_estacion id_interno                          nombre  latitud  longitud  \
0          413    A872872      25 DE MAYO - EEA PERGAMINO   -35.48    -60.13   
1          516    A872923     ABRA PAMPA - EEA ABRA PAMPA   -22.80    -65.83   
2          236    A872814         ALFONSO - EEA PERGAMINO   -33.91    -60.84   
3          393    A872885       ANDALGALA - EEA CATAMARCA   -27.61    -66.33   
4          403    A872912      ANDRESITO - EEA MONTECARLO   -25.62    -54.07   
5          233    A872823              ANGUIL -EEA ANGUIL   -36.54    -63.99   
6          468    A872838           APARICIO - EEA BARROW   -38.67    -60.93   
7          237    A872820       ARRECIFES - EEA PERGAMINO   -34.05    -60.14   
8          404    A872913  B DE IRIGOYEN - EEA MONTECARLO   -26.28    -53.67   
9          242    A872824         BALCARCE - EEA BALCARCE   -37.76    -58.30   

   id_provincia  id_localidad id_departamento  
0             0             0            6854  
1             9            78           38112  
2             0            14            6623  
3             2            30           46119  
4            13            95           54049  
5            10            82           42007  
6             0             5            6189  
7             0             1            6686  
8            13            96           54112  
9             0             2            6476  

Tabla: contagios
   id_uta departamento     provincia   ano  semanas_epidemiologicas  \
0    2003     COMUNA 3  BUENOS AIRES  2018                     15.0   
1    2004     COMUNA 4  BUENOS AIRES  2018                      6.0   
2    6091  BERAZATEGUI  BUENOS AIRES  2018                     11.0   
3    6091  BERAZATEGUI  BUENOS AIRES  2018                     14.0   
4    6091  BERAZATEGUI  BUENOS AIRES  2018                     19.0   
5    6091  BERAZATEGUI  BUENOS AIRES  2018                     21.0   
6    6427   LA MATANZA  BUENOS AIRES  2018                     12.0   
7    6427   LA MATANZA  BUENOS AIRES  2018                     16.0   
8    6441     LA PLATA  BUENOS AIRES  2018                     14.0   
9   50028   GUAYMALLEN       MENDOZA  2018                     23.0   

   grupo_edad_id     grupo_edad_desc  cantidad_casos  poblacion  id_provincia  
0              6     DE 15 A 19 ANOS             1.0     192945             0  
1              6     DE 15 A 19 ANOS             1.0     239279             0  
2              7     DE 20 A 24 ANOS             1.0     358262             0  
3              9     DE 35 A 44 ANOS             2.0     358262             0  
4             11  MAYORES DE 65 ANOS             1.0     358262             0  
5              9     DE 35 A 44 ANOS             1.0     358262             0  
6              6     DE 15 A 19 ANOS             1.0    2185597             0  
7              6     DE 15 A 19 ANOS             1.0    2185597             0  
8             11  MAYORES DE 65 ANOS             1.0     703504             0  
9             10     DE 45 A 65 ANOS             1.0     324272            12

Tabla: clima
   TOTAL DE REGISTROS
0              112530

Tabla: calendario
   TOTAL DE REGISTROS
0               24004

Tabla: provincias
   TOTAL DE REGISTROS
0                  24

Tabla: localidades
   TOTAL DE REGISTROS
0                 145

Tabla: departamentos
   TOTAL DE REGISTROS
0                 511

Tabla: estaciones
   TOTAL DE REGISTROS
0                 151

Tabla: contagios
   TOTAL DE REGISTROS
0               68126


El proyecto se basa en predecir los contagios que habra en una semana en especifico, teniendo en cueta los datos climaticos que hubo en las ultimas cuatro semanas.
El objetivo es predecir un rango de contagios que tendra un departamento en una semana. El rango debe ser de 0 a 5 contagios, de 6 a 10, de 11 a 15 o 16 o más.
Se deben utilizar todos los datos de la tabla de contagios.
Se debe crear variables "lags" del clima y de casos de contagios. Por cada variable climatica y de contagio, debe haber 4 columnas (promedio de una semana anterior, dos semanas anteriores, tres semanas anteriores y cuatro semanas anteriores.)
Ademas, se deben crear las variables de target (0 a 5 contagios, 6 a 10 contagios, etc) para que sea un problema de clasificacion multivariable.
Quiero que me des una query completa y robusta en SQL para poder agrupar todo esto anterior. Gracias.